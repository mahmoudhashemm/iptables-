ุชูุงู โุ ุฎูููุง ูุนูููุง ุจุงูุฑุงุญุฉ:

---

## ๐ฏ ุงููุฏู

ุชููู ุฃู **ุฎุฑูุฌ ููุฅูุชุฑูุช (outbound)** ูู ุงูุญุงููุงุช ุงููู ูู ุฑููุฌ:

```
10.0.0.0/8
```

ูุนูู ูู IP ูุจุฏุฃ ุจู `10.` (ุฒู: 10.0.0.202, 10.0.0.203โฆ ุฅูุฎ).

---

## ๐๏ธ ุงููุงุนุฏุฉ ูู iptables

ุนูู ุงูุณูุฑูุฑ (Ubuntu host):

```bash
iptables -I DOCKER-USER -s 10.0.0.0/8 -o eth0 -j DROP
```

### ูุนูู ุงููุงุนุฏุฉ:

* `-s 10.0.0.0/8` = ุฃู ุญุงููุฉ IPูุง ูุจุฏุฃ ุจู 10.*.*.\*
* `-o eth0` = ุชุญุงูู ุชุฎุฑุฌ ุนูู ุงูุฅูุชุฑูุช ูู ุงูุฅูุชุฑููุณ ุงูุฎุงุฑุฌู.
* `-j DROP` = ูุชููุน.

---

## ๐ ููุชุญูู

ุดูู ุงููุงุนุฏุฉ ุงูุถุงูุช:

```bash
iptables -L DOCKER-USER -n --line-numbers
```

---

## ๐พ ููุญูุธ ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู

```bash
netfilter-persistent save
```

ุฃู:

```bash
iptables-save > /etc/iptables/rules.v4
```

---

## ๐ ููุงุญุธุงุช

* ูุฏู ุฃู ุญุงููุฉ ุฌูู ุฑููุฌ 10.0.0.0/8 ูุด ูุชุทูุน ุฅูุชุฑูุช.
* ุจุณ ูุณู ููุฏุฑูุง ูุชูุงุตููุง ุฏุงุฎูููุง ุจูู ุจุนุถ (ุฏุงุฎู ููุณ ุดุจูุฉ Docker).
* ูู ุนุงูุฒ ุชุนูู ุงุณุชุซูุงุก (ูุซูุงู Odoo ูุทูุน ุนูู 443) ูุงุฒู ุชุถูู ูุงุนุฏุฉ ุณูุงุญ ูุจู ูุงุนุฏุฉ ุงูู DROP.

---

ุชุญุจ ุฃุฌูุฒูู ุณูุฑุจุช ููู:

* ููู ุงููุช ุนู 10.0.0.0/8 ุจุงููุงูู.
* ูุน ุฅููุงููุฉ ุฅุถุงูุฉ ุงุณุชุซูุงุกุงุช (ุจูุฑุชุงุช ุฃู ุญุงููุงุช ูุญุฏุฏุฉ)ุ







ุชูุงู โุ ุฎูููู ุฃุฏูู ููุฎุต ููุงุฆู ูุฑุชุจ ุชูุฏุฑ ุชุญูุธู ูู **Documentation** ุนูุฏู:

---

# ๐ ููุฎุต ุฅุนุฏุงุฏุงุช iptables ูุชุฃููู ุงูุญุงููุงุช + Mailcow

## ๐ฏ ุงููุฏู

* ุงูุณูุงุญ ููุท ูุญุงููุงุช Mailcow ุจุงูุฎุฑูุฌ ููุฅูุชุฑูุช ุนูู ุงูุจูุฑุชุงุช ุงูุถุฑูุฑูุฉ.
* ููุน ูู ุงูุญุงููุงุช ุงูุชุงููุฉ (Odoo, DB, โฆ) ูู ุงููุตูู ููุฅูุชุฑูุช.
* ุฅุจูุงุก ุงูุฏุฎูู (Inbound) ููุฎุฏูุงุช ุฒู Portainer, Odoo, Mailcow GUI ุดุบุงู ุนุงุฏู.

---

## ๐๏ธ ุงูููุงุนุฏ ุงููุนุงูุฉ ุญุงูููุง (DOCKER-USER chain)

### 1. Mailcow Subnet (`172.22.1.0/24`)

ูุณูุญ ุจุงูุฎุฑูุฌ ุนูู:

```bash
ACCEPT tcp  -- 172.22.1.0/24  0.0.0.0/0  tcp dpt:443            # HTTPS
ACCEPT tcp  -- 172.22.1.0/24  0.0.0.0/0  multiport dports 25,465,587   # SMTP
ACCEPT tcp  -- 172.22.1.0/24  0.0.0.0/0  tcp dpt:53             # DNS (TCP)
ACCEPT udp  -- 172.22.1.0/24  0.0.0.0/0  udp dpt:53             # DNS (UDP)
```

### 2. Fail2Ban (SSH protection)

```bash
f2b-sshd   tcp  -- 0.0.0.0/0  0.0.0.0/0  multiport dports 22
```

### 3. Ping (ุงุฎุชูุงุฑู ูููุฑุงูุจุฉ)

```bash
ACCEPT icmp -- 0.0.0.0/0  0.0.0.0/0
```

### 4. ููู ุฎุฑูุฌ ุจุงูู ุงูุญุงููุงุช

```bash
DROP all -- docker0 eth0  0.0.0.0/0  0.0.0.0/0   # ููุน ุฃู ุชุฑุงููู ูู docker0 ุฅูู ุงูุฅูุชุฑูุช
DROP all -- * eth0        0.0.0.0/0  0.0.0.0/0   # Safety net: ููุน ุฃู ุชุฑุงููู ููุฎุงุฑุฌ ูู ููุณูุญ ุจู
```

---

## โ ุงููุชูุฌุฉ

* Mailcow ูุดุชุบู ุทุจูุนู (DNS + SMTP + HTTPS).
* ุจุงูู ุงูุญุงููุงุช **ูููููุฉ ุฅูุชุฑูุช**.
* ุงูุฏุฎูู ุนูู ุจูุฑุชุงุช ุงูุฎุฏูุงุช (Portainer 9505, Odoo 8069, Mailcow 443) ุดุบุงู ุนุงุฏู.
* ุงูุญูุงูุฉ ูู brute force ุนูู SSH ุดุบุงูุฉ (Fail2Ban).

---

## ๐พ ููุญูุธ ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู

```bash
netfilter-persistent save
```

ุฃู:

```bash
iptables-save > /etc/iptables/rules.v4
```

---

ุชุญุจ ุฃุฌูุฒูู ูุณุฎุฉ **ุณูุฑูุจุช bash** ูููุง ุงูููุงุนุฏ ุฏู ูููุง (ready-to-run) ุจุญูุซ ูู ุงูุณูุฑูุฑ ููุน ุฃู rebooted ุชุฑุฌุนูุง ุจูููู ูุงุญุฏุ
